<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Compras</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-100 min-h-screen">
	<div class="flex">
		<div th:replace="fragments/BarraLateral :: barraLateral(${usuario})"></div>

		<div class="p-6 flex-grow">

			<p>
				<strong>ID:</strong> <span th:text="${solicitud.idSolicitud}"></span>
			</p>
			<p>
				<strong>Fecha de creaci√≥n:</strong> <span
					th:text="${#temporals.format(solicitud.fechaCreacion, 'dd/MM/yyyy HH:mm')}"></span>
			</p>
			<p>
				<strong>Estado:</strong> <span
					th:if="${solicitud.statusSolicitud == 'P'}"
					class="text-yellow-600 font-semibold">Pendiente</span> <span
					th:if="${solicitud.statusSolicitud == 'A'}"
					class="text-green-600 font-semibold">Aprobada</span> <span
					th:if="${solicitud.statusSolicitud == 'R'}"
					class="text-red-600 font-semibold">Rechazada</span>
			</p>

			<div class="mt-4">
				<form th:action="@{/jefecompras/compras/finalizar}" method="post">
					<input type="hidden" name="solicitudId"
						th:value="${solicitud.idSolicitud}" />

					<table class="min-w-full bg-white border rounded">
						<thead>
							<tr>
								<th>Insumo</th>
								<th>Cantidad</th>
								<th>Precio Unitario</th>
								<th>Total</th>
								<th>Proveedor</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="item : ${solicitud.elementos}">
								<td class="px-4 py-2 text-sm"
									th:text="${item.elemento.nomElemento}">Nombre</td>
								<td class="px-4 py-2 text-sm" th:text="${item.cantSolicitada}">0</td>

								<td class="px-4 py-2 text-sm"
									th:text="${precioMap[item.elemento.idElemento] != null ? precioMap[item.elemento.idElemento].precioElemento : 'N/A'}">
									0.00</td>

								<td class="px-4 py-2 text-sm"
									th:text="${precioMap[item.elemento.idElemento] != null ? #numbers.formatDecimal(precioMap[item.elemento.idElemento].precioElemento * item.cantSolicitada, 1, 'POINT', 2, 'NONE') : 'N/A'}">
									0.00</td>

								<td class="px-4 py-2 text-sm"><select
									name="proveedor_${item.elemento.idElemento}"
									class="form-select">
										<option
											th:each="p : ${precioMap[item.elemento.idElemento].proveedores}"
											th:value="${p.idProveedor}" th:text="${p.nomProveedor}">
											Proveedor</option>
								</select></td>
							</tr>
						</tbody>

						<!-- TOTAL GENERAL -->
						<tfoot>
							<tr>
								<td colspan="3" class="text-right font-bold px-4 py-2">Total:</td>
								<td colspan="2" class="font-bold px-4 py-2"
									th:text="${totalCompra != null ? #numbers.formatDecimal(totalCompra, 1, 'POINT', 2, 'NONE') : '0.00'}">
									0.00</td>
							</tr>
						</tfoot>
					</table>


					<div class="mt-4">
						<button type="submit"
							class="bg-green-600 text-white px-4 py-2 rounded">
							Finalizar Compra</button>
					</div>
				</form>

			</div>


		</div>
	</div>
	<script src="/scriptReutilisable.js"></script>
</body>
</html>
